---
import "@assets/app.css";
import Navbar from "@components/Navbar.astro";
import Footer from "@components/Footer.astro";
import FlagDivider from "@components/FlagDivider.astro";
import SeoWrapper from "@components/SeoWrapper.astro";
import Analytics from "@vercel/analytics/astro";
import SpeedInsights from "@vercel/speed-insights/astro";

const { title, description, path, image } = Astro.props;
---

<!doctype html>
<html lang="es" data-theme="forest">
  <head>
    <SeoWrapper
      title={`CRTeam${title ? " - " + title : ""}`}
      description={description}
      path={path}
      image={image}
    />

    <!-- Preconnect a recursos críticos externos para mejorar LCP -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />

    <!-- Precarga de fuentes para LCP -->
    <link
      rel="preload"
      as="style"
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700&display=swap"
      media="all"
    />
    <noscript>
      <link
        rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700&display=swap"
      />
    </noscript>

    <!-- DaisyUI: carga diferida para mejorar LCP -->
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@5"
      rel="stylesheet"
      type="text/css"
      media="print"
      onload="this.media='all'"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@5/themes.css"
      rel="stylesheet"
      type="text/css"
      media="print"
      onload="this.media='all'"
    />
  </head>
  <body class="overflow-x-hidden">
    <Navbar />
    <main id="main-content" class="overflow-x-hidden">
      <slot />
    </main>
    <FlagDivider class="mt-5 md:mt-15" />
    <Footer />
    <Analytics />
    <SpeedInsights />

    <script is:inline>
      // Fix para viewport height en móviles (prevenir rebote)
      function setViewportHeight() {
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty("--vh", `${vh}px`);
      }

      // Prevenir scroll bounce en iOS
      function preventBounce() {
        let startY = 0;

        document.addEventListener(
          "touchstart",
          function (e) {
            startY = e.touches[0].pageY;
          },
          { passive: false }
        );

        document.addEventListener(
          "touchmove",
          function (e) {
            const y = e.touches[0].pageY;
            const scrollTop =
              document.documentElement.scrollTop || document.body.scrollTop;
            const scrollHeight =
              document.documentElement.scrollHeight ||
              document.body.scrollHeight;
            const clientHeight =
              document.documentElement.clientHeight ||
              document.body.clientHeight;

            // Prevenir scroll bounce en la parte superior
            if (scrollTop <= 0 && y > startY) {
              e.preventDefault();
            }

            // Prevenir scroll bounce en la parte inferior
            if (scrollTop + clientHeight >= scrollHeight && y < startY) {
              e.preventDefault();
            }
          },
          { passive: false }
        );
      }

      // Inicializar al cargar la página
      setViewportHeight();
      preventBounce();

      // Actualizar en resize
      window.addEventListener("resize", setViewportHeight);
      window.addEventListener("orientationchange", function () {
        setTimeout(setViewportHeight, 100);
      });
    </script>
  </body>
</html>
