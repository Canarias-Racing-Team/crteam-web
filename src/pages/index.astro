---
import Carousel from "@components/Carousel.astro";
import Gallery from "@components/Gallery.astro";
import FlagDivider from "@components/FlagDivider.astro";
import Hero from "@components/Hero.astro";
import Layout from "@layouts/Layout.astro";
import CarTabs from "@components/CarTabs.astro";
import Card from "@components/Card.astro";
import Section from "@components/Section.astro";
import Stats from "@components/Stats.astro";
import { loadImageEntries } from "@utils/imageUtils";
import { texts, createCardContent } from "@utils/texts";

export const prerender = true;

// Image data
type Partner = {
  featured?: boolean;
  [key: string]: any;
};

// Partners
let partners: Partner[] = [];
let featuredPartners: Partner[] = [];
try {
  partners = await loadImageEntries("logos-partners-2425");
  featuredPartners = partners.filter((partner) => partner.featured === true);
  partners = [
    ...featuredPartners,
    ...partners.filter((partner) => partner.featured !== true),
  ];
  console.log(
    `✅ Loaded ${partners.length} partners, ${featuredPartners.length} featured`
  );
} catch (error) {
  console.error("❌ Error loading partners data:", error);
}

import imagesExample from "@assets/imagesExample.json";

// Car components data
import carComponents from "@assets/carComponents.json";
---

<Layout
  id={Astro.self.name}
  description="Primer equipo de Formula Student de Canarias. Estudiantes de la ULL compitiendo internacionalmente con un monoplaza eléctrico. Innovación, formación y pasión por el motor desde las Islas Canarias."
  path=""
  image="/assets/logos-crteam/CRTEAM BLANCO.png"
>
  <Hero />

  <FlagDivider />

  <Section id="partners-principal" className="min-h-[200px]">
    {
      featuredPartners.length > 0 ? (
        <div class="w-full lg:w-3/4 h-full self-center">
          <Gallery
            items={featuredPartners}
            alt="Logos de socios destacados"
            className="justify-between"
          />
        </div>
      ) : (
        <div class="w-full lg:w-3/4 flex items-center justify-center text-center">
          <p class="text-gray-500">Cargando socios destacados...</p>
        </div>
      )
    }
    <Stats className="w-full lg:w-1/4" />
  </Section>

  <Section id="team">
    <Card
      className="w-full lg:w-2/3"
      buttons={[
        {
          text: "Únete",
          href: "#contact",
          icon: "mdi:account-plus",
        },
      ]}
      content={createCardContent(texts.home.team)}
    />
    <Carousel
      items={imagesExample}
      id="team-carousel"
      className="w-full lg:w-1/3 h-[456px] flex flex-col justify-center items-center"
    />
  </Section>

  <Section id="car">
    <Card
      className="w-full lg:w-1/3"
      content={createCardContent(texts.home.car)}
    />
    <CarTabs
      carComponents={carComponents}
      id="car-components"
      className="w-full lg:w-2/3 h-[324px]"
    />
  </Section>

  <Section id="partners">
    {
      partners.length > 0 ? (
        <Gallery
          items={partners}
          alt="Logos de todos los socios"
          className="w-full lg:w-3/4 h-full md:h-[414px]"
        />
      ) : (
        <div class="w-full lg:w-3/4 flex items-center justify-center text-center">
          <p class="text-gray-500">Cargando socios...</p>
        </div>
      )
    }
    <Card
      className="w-full lg:w-1/3"
      content={createCardContent(texts.home.contact)}
      buttons={[
        {
          text: "Patrocinio",
          icon: "mdi:account-multiple-plus",
          href: "#contact",
        },
      ]}
    />
  </Section>
</Layout>
