---
import NewsCard from "@components/NewsCard.astro";
import Layout from "@layouts/Layout.astro";
import Section from "@components/Section.astro";
import Card from "@components/Card.astro";
import { getNotionPages } from "@utils/notion";
import { texts } from "@utils/texts";
import { createCardContent } from "@utils/texts";

export const prerender = true;

// Generación de rutas estáticas para cada noticia
export async function getStaticPaths() {
  try {
    const pages = await getNotionPages();
    return pages
      .filter((page) => !!page.url)
      .map((page) => ({
        params: { slug: page.url },
        props: { noticia: page },
      }));
  } catch (error) {
    console.error("Error al obtener páginas de Notion:", error);
    return [];
  }
}

const { noticia } = Astro.props;

if (!noticia) {
  return Astro.redirect("/news");
}

// Datos para SEO de artículo
const articleTitle = noticia.Nombre || "Noticia";
const articleDescription =
  noticia.Contenido?.substring(0, 160) + "..." ||
  "Noticia del Canarias Racing Team";
const articleImage = noticia.Imagen
  ? `/api/proxy-image?url=${encodeURIComponent(noticia.Imagen)}`
  : undefined;
const articlePath = `/news/${noticia.url}`;
const publishedDate = noticia.Fecha
  ? new Date(noticia.Fecha).toISOString()
  : new Date().toISOString();

// Tags relacionados con Formula Student y automovilismo
const articleTags = [
  "Formula Student",
  "Canarias Racing Team",
  "CRTeam",
  "Universidad La Laguna",
  "Monoplaza Eléctrico",
  "Competición Universitaria",
];
---

<Layout
  id={Astro.self.name}
  title={`${articleTitle} - CRTeam Noticias`}
  description={articleDescription}
  path={articlePath}
  image={articleImage}
  type="article"
  publishedTime={publishedDate}
  modifiedTime={publishedDate}
  author="Canarias Racing Team"
  section="Noticias"
  tags={articleTags}
>
  <Section id="noticia-individual" className="py-15 gap-4">
    <aside
      id="titles"
      class="w-full lg:w-1/3 flex flex-col gap-4 lg:sticky lg:self-start lg:h-fit lg:top-25"
    >
      <Card
        content={createCardContent(texts.newsDetails.aboutTeam)}
        buttons={[
          {
            text: "Volver a noticias",
            href: "/news",
            icon: "mdi:arrow-left",
          },
        ]}
      />
    </aside>
    <div class="w-full lg:w-2/3">
      <NewsCard noticia={noticia} />
    </div>
  </Section>
</Layout>
